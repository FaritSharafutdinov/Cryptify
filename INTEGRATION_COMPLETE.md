# –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ML –∏ Backend - –ó–∞–≤–µ—Ä—à–µ–Ω–æ ‚úÖ

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

**–°–æ–∑–¥–∞–Ω –æ–±—â–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –º–æ–¥—É–ª—å:**
- `config.py` - –∫–æ—Ä–Ω–µ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
- `scripts/config.py` - –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è ML-—Å–∫—Ä–∏–ø—Ç–æ–≤

**–û–±–Ω–æ–≤–ª–µ–Ω—ã ML-—Å–∫—Ä–∏–ø—Ç—ã:**
- `data_collector.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–∏–π –∫–æ–Ω—Ñ–∏–≥
- `multi_model_trainer.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–∏–π –∫–æ–Ω—Ñ–∏–≥
- `predictor.py` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–∏–π –∫–æ–Ω—Ñ–∏–≥

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ë–î

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –í ML-—Å–∫—Ä–∏–ø—Ç–∞—Ö
from config import DATABASE_URL, DB_HOST, DB_USER, ...

# –í –±–µ–∫–µ–Ω–¥–µ
from config import DATABASE_URL
```

### 2. ‚úÖ Endpoints –¥–ª—è –∑–∞–ø—É—Å–∫–∞ ML-—Å–∫—Ä–∏–ø—Ç–æ–≤

**–°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å:**
- `backend/services/ml_script_service.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º —Å–∫—Ä–∏–ø—Ç–æ–≤

**–î–æ–±–∞–≤–ª–µ–Ω—ã endpoints:**
- `POST /ml/scripts/run` - –∑–∞–ø—É—Å–∫ –ª—é–±–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
- `POST /ml/data-collector/run` - –∑–∞–ø—É—Å–∫ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- `POST /ml/trainer/run` - –∑–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
- `POST /ml/predictor/run` - –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è
- `GET /ml/scripts/status/{script_name}` - —Å—Ç–∞—Ç—É—Å —Å–∫—Ä–∏–ø—Ç–∞
- `GET /ml/scripts/status` - —Å—Ç–∞—Ç—É—Å—ã –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
- `GET /ml/scripts/available` - —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
- `POST /ml/scripts/{script_name}/cancel` - –æ—Ç–º–µ–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞
- –¢–∞–π–º–∞—É—Ç—ã
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞
- –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

### 3. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–°–æ–∑–¥–∞–Ω—ã —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
- `backend/schemas/validation.py` - Pydantic —Å—Ö–µ–º—ã

**–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫

**–í–∞–ª–∏–¥–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç:**
- –ò–º–µ–Ω–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ (whitelist)
- –ê—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–π)
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã
- –õ–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- –ì–æ—Ä–∏–∑–æ–Ω—Ç—ã –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Cryptify/
‚îú‚îÄ‚îÄ config.py                    # –û–±—â–∏–π –∫–æ–Ω—Ñ–∏–≥ (–ù–û–í–û–ï)
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.py             # –û–±–Ω–æ–≤–ª–µ–Ω–æ: –Ω–æ–≤—ã–µ endpoints, –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model_service.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ml_script_service.py # –ù–û–í–û–ï: —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py         # –ù–û–í–û–ï
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validation.py       # –ù–û–í–û–ï: —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.py         # –û–±–Ω–æ–≤–ª–µ–Ω–æ: –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ env.example             # –û–±–Ω–æ–≤–ª–µ–Ω–æ: –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ config.py              # –ù–û–í–û–ï: –∞–¥–∞–ø—Ç–µ—Ä –∫–æ–Ω—Ñ–∏–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ data_collector.py       # –û–±–Ω–æ–≤–ª–µ–Ω–æ: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–∏–π –∫–æ–Ω—Ñ–∏–≥
‚îÇ   ‚îú‚îÄ‚îÄ multi_model_trainer.py  # –û–±–Ω–æ–≤–ª–µ–Ω–æ: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–∏–π –∫–æ–Ω—Ñ–∏–≥
‚îÇ   ‚îî‚îÄ‚îÄ predictor.py           # –û–±–Ω–æ–≤–ª–µ–Ω–æ: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–∏–π –∫–æ–Ω—Ñ–∏–≥
‚îî‚îÄ‚îÄ docker/
    ‚îî‚îÄ‚îÄ init.sql                # –û–±–Ω–æ–≤–ª–µ–Ω–æ: –ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ï–¥–∏–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î:**
```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω—ã–π URL
DATABASE_URL=postgresql://user:password@host:5432/database

# –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–¥–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
DB_HOST=localhost
DB_USER=criptify_user
DB_PASSWORD=criptify_password
DB_NAME=criptify_db
DB_PORT=5432
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
1. `DATABASE_URL` (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω)
2. –û—Ç–¥–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`DB_HOST`, `DB_USER`, etc.)
3. –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

## API Endpoints

### ML Scripts Management

**–ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
```bash
POST /ml/data-collector/run
{
  "mode": "incremental",
  "timeout": 1800
}
```

**–ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è:**
```bash
POST /ml/trainer/run
{
  "mode": "batch",
  "timeout": 3600
}
```

**–ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è:**
```bash
POST /ml/predictor/run
{
  "timeout": 300
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
```bash
GET /ml/scripts/status/data_collector.py
```

### Data Endpoints (–æ–±–Ω–æ–≤–ª–µ–Ω—ã)

**–ü—Ä–æ–≥–Ω–æ–∑—ã:**
```bash
GET /predictions/latest?limit=10&model_name=LinearRegression&horizon=6
```

**Features:**
```bash
GET /features/latest?limit=100
GET /features?from_time=2024-01-01&to_time=2024-01-07
```

**–ú–µ—Ç—Ä–∏–∫–∏:**
```bash
GET /metrics/latest?model_name=LinearRegression_log_return_6h
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:**
```json
{
  "status": "error",
  "error": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏",
  "timestamp": "2024-01-01T12:00:00",
  "details": {
    "additional_info": "..."
  }
}
```

**HTTP –∫–æ–¥—ã:**
- `400` - –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `404` - –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `409` - –ö–æ–Ω—Ñ–ª–∏–∫—Ç (—Å–∫—Ä–∏–ø—Ç —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è)
- `422` - –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Pydantic
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω —Å–∫—Ä–∏–ø—Ç–æ–≤ (whitelist)
‚úÖ –ó–∞—â–∏—Ç–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–π
‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `backend/ML_INTEGRATION.md` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ML –∏ Backend
- `backend/ML_SCRIPTS_API.md` - API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞–º–∏
- `INTEGRATION_COMPLETE.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. **–û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á:**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Celery –∏–ª–∏ RQ –¥–ª—è production
   - –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –ú–µ—Ç—Ä–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤
   - –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

3. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:**
   - –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (cron —á–µ—Ä–µ–∑ API)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
python -c "from config import DATABASE_URL; print(DATABASE_URL)"
```

**–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ —á–µ—Ä–µ–∑ API:**
```bash
curl -X POST http://localhost:8000/ml/predictor/run \
  -H "Content-Type: application/json" \
  -d '{"timeout": 300}'
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
```bash
curl http://localhost:8000/ml/scripts/status/predictor.py
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ML-—Å–∫—Ä–∏–ø—Ç–∞–º–∏
‚úÖ –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ

